//ë³€ìˆ˜ê°’ë“¤ ì •ë¦¬!
let mic;
let vol = 0;
let smoothVol = 0;
let wave = [];
let threshold = 0.05;
let changeThreshold = 0.02;
let lastSmoothVol = 0;

function setup() {
  createCanvas(windowWidth, windowHeight);

  // í™”ë©´ì „ì²´ ë°°ê²½ìƒ‰
  background(255, 253, 240); 

  mic = new p5.AudioIn();
  mic.start(onMicStart, onMicError);
}

  // ë§ˆì´í¬ ì‘ë™ë˜ëŠ”ì§€ ì—¬ë¶€ í™•ì¸
function onMicStart() {
  console.log("ğŸ¤ ê°€ë³´ìê³ ");
}

function onMicError(err) {
  console.error("ğŸš« ì•ˆë˜ê²„ë‹¤:", err);
}

function draw() {
  // ì•„ì´ë³´ë¦¬ ë°°ê²½ + ì‚´ì§ ì”ìƒíš¨ê³¼ ìœ ì§€
  background(255, 253, 240, 50); 

  let centerY = height / 2;
  
  if (mic) {
    vol = mic.getLevel();
        // smoothVolì´ volì„ ì„œì„œíˆ ë”°ë¼ê°€ë„ë¡
    smoothVol = lerp(smoothVol, vol, 0.1); // â† 0.1ì€ ë°˜ì‘ ì†ë„ ì¡°ì ˆ (0.01 ~ 0.3)

    let diameter = map(smoothVol, 0, 1, 50, width);

    // ì§„í­ë³€í™”ëŸ‰ì´ changeThreshold ì´ìƒì¼ ë•Œë§Œ íŒŒë™í‘œí˜„
    let volChange = abs(smoothVol - lastSmoothVol);

    if (smoothVol > threshold && volChange > changeThreshold) {
   
      wave.push(smoothVol); // ì§„í­ì„ ë°°ì—´ì— ì¶”ê°€

    // ë°°ì—´ì˜ ê¸¸ì´ê°€ ë„ˆë¬´ ê¸¸ì–´ì§€ë©´ ì˜¤ë˜ëœ ê°’ì„ ì œê±°
    if (wave.length > width) {
      wave.shift();
    }
    
      // íŒŒë™ ì„  ìƒ‰ìƒ
    stroke('#B8B4A8'); 
    noFill();
    beginShape();
    
    // íŒŒë™ì„ ì„ ìœ¼ë¡œ ê·¸ë¦¬ê¸°
   beginShape();
for (let i = 0; i < wave.length; i++) {
  let x = i * (width / wave.length);
  let y = centerY + (wave[i] - 0.5) * 600;
  curveVertex(x, y);
}
endShape();

    }
    
    // ğŸ¯ í¬ê¸°-ìƒ‰ìƒì´ ë¶‰ì€ ê³„ì—´ë¡œ ë³€í•˜ë„ë¡
let baseRadius = 100; // ì›ì˜ ê¸°ë³¸ í¬ê¸°
let radius = baseRadius + smoothVol * 500;

// ë³¼ë¥¨ì´ ì»¤ì§ˆìˆ˜ë¡ íŒŒë€ìƒ‰ â†’ ë¶‰ì€ìƒ‰ ìì—° ì „í™˜
let c = lerpColor(color('#D7E9F7'), color('#E63946'), constrain((radius - baseRadius) / baseRadius, 0, 1));

fill(c);
noStroke();
ellipse(width / 2, centerY, radius, radius);

      lastSmoothVol = smoothVol;
  }
}
  
